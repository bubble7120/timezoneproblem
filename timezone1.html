<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>🚫 Case 1：結束時間 UTC 00:00 導致漏抓</title>
  <style>
    body { font-family: 'Segoe UI'; background: #eef4ff; padding: 2rem; }
    h2 { color: #0b5394; }
    label, input, button { font-size: 1rem; margin: 0.4rem; }
    button { padding: 0.4rem 0.8rem; cursor: pointer; }
    table { border-collapse: collapse; width: 100%; margin-top: 1rem; }
    th, td { border: 1px solid #aaa; padding: 0.5rem; }
    th { background: #dceeff; }
    tr.missed { background-color: #fff4b3; }
    .container { display: flex; gap: 2rem; flex-wrap: wrap; }
    .panel { flex: 1; background: #fff; padding: 1rem; border-radius: 6px; box-shadow: 0 0 4px rgba(0,0,0,0.1); min-width: 460px; }
    .query-info { font-size: 0.85rem; color: #555; margin-top: 0.5rem; }
  </style>
</head>
<body>
  <h2>🚫 Case 1：結束時間 UTC 00:00 導致漏抓美西 7/3</h2>

  <label>起始日（PDT）:</label>
  <input type="date" id="start" value="2025-06-27" />
  <label>結束日（PDT）:</label>
  <input type="date" id="end" value="2025-07-03" />
  <button onclick="runFilter()">查詢比較</button>

  <div class="container">
    <div class="panel">
      <h3>❌ 錯誤邏輯（end = UTC 7/3 00:00）</h3>
      <div class="query-info" id="infoWrong"></div>
      <table>
        <thead><tr><th>貨單</th><th>港口</th><th>CNT</th><th>ETA</th><th>UTC</th></tr></thead>
        <tbody id="wrongTable"></tbody>
      </table>
    </div>
    <div class="panel">
      <h3>✅ 修正邏輯（PDT → UTC +1 天）</h3>
      <div class="query-info" id="infoRight"></div>
      <table>
        <thead><tr><th>貨單</th><th>港口</th><th>CNT</th><th>ETA</th><th>UTC</th></tr></thead>
        <tbody id="rightTable"></tbody>
      </table>
    </div>
  </div>

  <script>
    const shipments = [
      { code: 'LA10230', port: 'Long Beach', cnt: 'CNT001120', eta: "2025-06-27T10:00:00-07:00" },
      { code: 'LA10239', port: 'Los Angeles', cnt: 'CNT001122', eta: "2025-06-28T11:30:00-07:00" },
      { code: 'LA10257', port: 'Oakland', cnt: 'CNT003377', eta: "2025-07-02T14:00:00-07:00" },
      { code: 'LA10300', port: 'Seattle', cnt: 'CNT007711', eta: "2025-07-03T09:30:00-07:00" },
      { code: 'LA10301', port: 'Portland', cnt: 'CNT007855', eta: "2025-07-03T16:00:00-07:00" },
      { code: 'LA10302', port: 'Tacoma', cnt: 'CNT007900', eta: "2025-07-03T23:50:00-07:00" }
    ];

    function runFilter() {
      const startStr = document.getElementById("start").value;
      const endStr = document.getElementById("end").value;

      const start = new Date(`${startStr}T00:00:00-07:00`);
      const endWrong = new Date(`${endStr}T00:00:00Z`);
      const endRight = new Date(`${endStr}T00:00:00-07:00`);
      endRight.setDate(endRight.getDate() + 1);

      document.getElementById("infoWrong").textContent = `查詢時間（錯誤）：${start.toISOString()} ~ ${endWrong.toISOString()}`;
      document.getElementById("infoRight").textContent = `查詢時間（正確）：${start.toISOString()} ~ ${endRight.toISOString()}`;

      const wrongTable = document.getElementById("wrongTable");
      const rightTable = document.getElementById("rightTable");
      wrongTable.innerHTML = "";
      rightTable.innerHTML = "";

      shipments.forEach(s => {
        const eta = new Date(s.eta);
        const etaUTC = eta.toISOString();
        const missed = eta >= endWrong;

        const row = `<tr${missed ? ' class="missed"' : ''}>
          <td>${s.code}</td><td>${s.port}</td><td>${s.cnt}</td><td>${s.eta}</td><td>${etaUTC}</td>
        </tr>`;

        if (eta >= start && eta < endWrong) wrongTable.innerHTML += row;
        if (eta >= start && eta < endRight) rightTable.innerHTML += row;
      });
    }
  </script>
</body>
</html>